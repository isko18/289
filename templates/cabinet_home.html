{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>kargoexpress281 ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{% static 'css/cabinet-home.css' %}" />
</head>
<body
  class="theme-light"
  data-default-theme="{% if site_settings and site_settings.default_dark_mode %}dark{% else %}light{% endif %}"
  {% if site_settings %}
    style="
      {% if site_settings.bg_light %}
        --bg-light: url('{{ site_settings.bg_light.url }}');
      {% endif %}
      {% if site_settings.bg_dark %}
        --bg-dark: url('{{ site_settings.bg_dark.url }}');
      {% endif %}
    "
  {% endif %}
>
  <div class="app">
    <!-- HEADER -->
    <header class="header">
      <div class="header__logo">
        {% if site_settings and site_settings.logo %}
          <img src="{{ site_settings.logo.url }}" alt="{{ site_settings.title }}" class="header__logo-img" />
        {% else %}
          <img src="{% static 'img/logo.png' %}" alt="kargoexpress281" class="header__logo-img" />
        {% endif %}
      </div>

      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
      <button
        type="button"
        class="theme-toggle"
        id="themeToggleBtn"
        aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"
      >
        üåô
      </button>
    </header>

    <!-- MAIN -->
    <main class="main">
      <section class="page page--home" id="page-home">
        <div class="layout">
          <!-- –û—Ç—Å–ª–µ–¥–∏—Ç—å —Ç–æ–≤–∞—Ä -->
          <div class="card">
            <h2 class="card__title">–û—Ç—Å–ª–µ–¥–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
            <form class="track-form" id="trackSearchForm">
              <div class="input-wrapper">
                <input
                  id="trackSearchInput"
                  type="text"
                  class="input"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä"
                />
                <button type="submit" class="icon-button" title="–ò—Å–∫–∞—Ç—å">
                  üîç
                </button>
              </div>
              <p class="helper-text text-center">
                –í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–∞—à–µ–π –ø–æ—Å—ã–ª–∫–∏
              </p>
            </form>
          </div>

          <!-- –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä -->
          <div class="card">
            <h2 class="card__title">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä</h2>
            <form
              class="track-form"
              id="trackAddForm"
              method="post"
              action="{% url 'cabinet_home' %}"
            >
              {% csrf_token %}
              <div id="trackAddInputs">
                <input
                  name="tracks"
                  type="text"
                  class="input"
                  placeholder="–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä"
                  maxlength="20"
                />
              </div>

              <!-- –°–±—Ä–æ—Å —Ç—Ä–µ–∫–æ–≤ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–≤–æ–¥–µ) -->
              <button
                type="button"
                class="btn btn--secondary"
                id="trackResetBtn"
                style="display: none; margin-top: 0.5rem;"
              >
                –°–±—Ä–æ—Å–∏—Ç—å
              </button>

              <button type="submit" class="btn btn--primary">
                –î–æ–±–∞–≤–∏—Ç—å
              </button>
              <p class="helper-text text-center">
                –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ 5 —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑. –ö–∞–∂–¥—ã–π —Ç—Ä–µ–∫ ‚Äî 1‚Äì20 —Å–∏–º–≤–æ–ª–æ–≤.
              </p>
            </form>
          </div>

          <!-- –°—Ç–∞—Ç—É—Å—ã -->
          <div class="card card--fullwidth">
            <h3 class="card__title">–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
            <div class="status-grid">
              <button
                type="button"
                class="status-card status-card--primary status-card--s1"
                data-status="1"
              >
                <span class="status-card__badge" id="status-count-1">
                  {{ status_count_1|default:"0" }}
                </span>
                <p class="status-card__label">
                  –ü—Ä–∏–Ω—è—Ç –Ω–∞ —Å–∫–ª–∞–¥ –≤ –ö–∏—Ç–∞–µ
                </p>
              </button>

              <button
                type="button"
                class="status-card status-card--s2"
                data-status="2"
              >
                <span class="status-card__badge status-card__badge--right" id="status-count-2">
                  {{ status_count_2|default:"0" }}
                </span>
                <p class="status-card__label">
                  –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏–∑ –ö–∏—Ç–∞—è
                </p>
              </button>

              <button
                type="button"
                class="status-card status-card--s3"
                data-status="3"
              >
                <span class="status-card__badge" id="status-count-3">
                  {{ status_count_3|default:"0" }}
                </span>
                <p class="status-card__label">
                  –ü—Ä–∏–±—ã–ª –≤ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏
                </p>
              </button>

              <button
                type="button"
                class="status-card status-card--s4"
                data-status="4"
              >
                <span class="status-card__badge status-card__badge--right" id="status-count-4">
                  {{ status_count_4|default:"0" }}
                </span>
                <p class="status-card__label">
                  –ü–æ–ª—É—á–µ–Ω
                </p>
              </button>
            </div>
          </div>

          <!-- –ú–æ–∏ –ø–æ—Å—ã–ª–∫–∏ -->
          <div class="card card--fullwidth" id="trackListCard">
            <h3 class="card__title">–ú–æ–∏ –ø–æ—Å—ã–ª–∫–∏</h3>
            <div class="track-list" id="trackListWrapper">
              {% if parcels %}
                {% for parcel in parcels %}
                  <div
                    class="track-item{% if forloop.counter > 5 %} track-item--hidden{% endif %}"
                    data-status="{{ parcel.status }}"
                    data-parcel-id="{{ parcel.id }}"
                    data-history-url="{% url 'parcel_history' parcel.id %}"
                  >
                    <div class="track-item__main">
                      <p class="track-item__number">
                        {{ parcel.track_number }}
                      </p>
                      <p class="track-item__status track-item__status--{{ parcel.status }}">
                        {{ parcel.get_status_display }}
                      </p>
                    </div>
                  </div>
                {% endfor %}

                {% if parcels|length > 5 %}
                  <button
                    type="button"
                    class="btn btn--secondary track-list__more"
                    id="trackShowMoreBtn"
                    data-step="5"
                    style="margin-top: 0.75rem;"
                  >
                    –ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë
                  </button>
                {% endif %}
              {% else %}
                <div class="empty-state">
                  <div class="empty-state__icon">üì¶</div>
                  <p>
                    –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ—Å—ã–ª–æ–∫. –í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä –≤—ã—à–µ,
                    —á—Ç–æ–±—ã –ø—Ä–∏–≤—è–∑–∞—Ç—å –ø–æ—Å—ã–ª–∫—É –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É.
                  </p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
      <a
        href="{% url 'cabinet_home' %}"
        class="bottom-nav__item bottom-nav__item--active"
      >
        <span class="bottom-nav__icon">üè†</span>
        <span class="bottom-nav__label">–ì–ª–∞–≤–Ω–æ–µ</span>
      </a>
      <a
        href="{% url 'cabinet_profile' %}"
        class="bottom-nav__item"
      >
        <span class="bottom-nav__icon">üë§</span>
        <span class="bottom-nav__label">–ü—Ä–æ—Ñ–∏–ª—å</span>
      </a>
    </nav>

    <!-- MODAL: —Å–ø–∏—Å–æ–∫ –ø–æ —Å—Ç–∞—Ç—É—Å—É -->
    <div class="modal hidden" id="statusModal">
      <div class="modal__backdrop"></div>
      <div class="modal__content">
        <div class="modal__header">
          <h3 class="modal__title" id="statusModalTitle"></h3>
          <button type="button" class="icon-button" data-modal-close="statusModal">
            ‚úï
          </button>
        </div>
        <div class="modal__body" id="statusModalBody">
          <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ JS -->
        </div>
      </div>
    </div>

    <!-- MODAL: –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–∫–∞ -->
    <div class="modal hidden" id="historyModal">
      <div class="modal__backdrop"></div>
      <div class="modal__content">
        <div class="modal__header">
          <h3 class="modal__title" id="historyModalTitle">–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</h3>
          <button type="button" class="icon-button" data-modal-close="historyModal">
            ‚úï
          </button>
        </div>
        <div class="modal__body">
          <div class="timeline" id="historyTimeline">
            <!-- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–∫–∞ –∏–∑ JS -->
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
      <p>&copy; 2025 kargoexpress281. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>
  </div>

  <script src="{% static 'js/cabinet-theme.js' %}"></script>
  <script src="{% static 'js/cabinet-home.js' %}"></script>
</body>
</html>
